<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Python DEMO</title>
    <style>
      div {
        /* border: 1px solid #000; */
      }
    </style>
  </head>
  <body>
    <script src="./data.js"></script>
    <script>
      window.onload = function () {
        filter(data, { top: 0, left: 0 });
        main(data);
      };

      function filter(data, p) {
        data.children.map(function (item, index) {
          if (item.children) {
            filter(item, { top: item.top, left: item.left });
          }
          item.top -= p.top;
          item.left -= p.left;
          delete item.bottom;
          delete item.right;
        });
      }

      function element(node, root) {
        var html = "";
        html += '<div style="position:absolute;';

        if (root) {
          // 根节点
          html += "overflow:hidden;border:2px solid red;";
        }

        if (node.width) {
          html += "width:" + node.width + "px;";
        }
        if (node.height) {
          html += "height:" + node.height + "px;";
        }
        if (node.top) {
          html += "top:" + node.top + "px;";
        }
        if (node.left) {
          html += "left:" + node.left + "px;";
        }

        if (node.image) {
          html +=
            "background-image:url('./images/" +
            node.layer_id +
            ".png');background-size:100% 100%;";
        }
        html += '">';
        html += children(node.children);
        html += "</div>";
        return html;
      }

      function children(children) {
        var html = "";
        if (children) {
          for (var i = 0; i < children.length; i++) {
            html += element(children[i], false);
          }
        }
        return html;
      }

      function main(data) {
        var html = "";
        html += element(data, true);

        document.body.style.transformOrigin = "0 0";
        var minScale = Math.min(800 / data.width, 800 / data.height);
        document.body.style.transform = "scale(" + minScale + ")";
        document.body.innerHTML = html;
      }
    </script>
  </body>
</html>
